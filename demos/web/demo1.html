<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasas de Cambio Dólar</title>
    <!-- Incluye Tailwind CSS para un estilo moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .button-loading {
            cursor: not-allowed;
            opacity: 0.7;
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen">

    <!-- Menú de navegación fijo -->
    <nav class="fixed top-0 left-0 right-0 bg-gray-900 bg-opacity-90 backdrop-blur-sm shadow-lg z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="text-xl font-bold text-white">App de Tasas</span>
            </div>
            <div class="space-x-4 flex items-center">
                <a href="#" onclick="showSection('tasa-cambio')" id="link-tasa" class="text-orange-500 hover:text-white transition-colors flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
                        <path d="M16 11V5.828l-5.657 5.657L8 8.172 2.343 13.828l1.414 1.414L8 10.999l2.828 2.829 5.657-5.657V11h2V3h-8v2h4.172l-7 7L2 14.828 3.414 16.242 8 11.657 10.828 14.485 16 9.313V16h2V11z"/>
                    </svg>
                </a>
                <a href="#" onclick="showSection('calculadora')" id="link-calculadora" class="text-gray-300 hover:text-orange-500 transition-colors flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
                        <path d="M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zm0 16H5V5h14v14zM8 7h2v2H8zm4 0h2v2h-2zm4 0h2v2h-2zM8 11h2v2H8zm4 0h2v2h-2zm4 0h2v2h-2zM8 15h2v2H8zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                    </svg>
                </a>
                <a href="#" onclick="showSection('info')" id="link-info" class="text-gray-300 hover:text-orange-500 transition-colors flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
                        <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm-1-12h2v6h-2zm0 8h2v-2h-2z" />
                    </svg>
                </a>
            </div>
        </div>
    </nav>

    <main class="max-w-2xl mx-auto p-6 pt-20 bg-gray-800 rounded-3xl shadow-2xl w-full">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-white mb-2">Tasa de Cambio del Día</h1>
            <p class="text-gray-400 text-lg">Dólar a Bolívar Soberano</p>
        </header>

        <section id="tasa-cambio" class="grid grid-cols-1 md:grid-cols-1 gap-6">

            <!-- Tarjeta del Dólar -->
            <div class="bg-gray-700 p-6 rounded-2xl shadow-lg border border-gray-600">
                <div class="flex items-center justify-between mb-4">
                    <div class="text-5xl font-bold text-orange-500">
                        $
                    </div>
                    <div class="text-right">
                        <h2 class="text-xl font-semibold text-white">Dólar (USD)</h2>
                        <span class="text-sm font-medium text-gray-400">Tasa de referencia</span>
                    </div>
                </div>
                <div class="text-center">
                    <p id="usd-rate" class="text-4xl font-extrabold text-white leading-tight">--</p>
                    <p class="text-sm text-gray-400 mt-2">
                        <span id="usd-last-updated">Actualizado: --/--/----</span>
                    </p>
                </div>
            </div>

        
            <!-- Botón para actualizar -->
            <div class="mt-6 text-center">
                <button id="update-button" class="w-full px-6 py-3 bg-orange-500 text-white font-semibold rounded-xl shadow-md hover:bg-orange-600 transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2">
                    Actualizar Tasa
                </button>
            </div>

            <!-- Mensaje de estado -->
            <div id="status-message" class="mt-8 text-center text-sm text-red-400 hidden">
                No se pudo obtener la tasa de cambio. Por favor, intenta de nuevo más tarde.
            </div>

        </section>

        <section id="calculadora" class="hidden">
            <hr class="border-gray-700 my-8">
            <!-- Sección de la Calculadora -->
            <div class="bg-gray-700 p-6 rounded-2xl shadow-lg border border-gray-600">
                <div class="flex items-center mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 text-orange-500 mr-4" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zm0 16H5V5h14v14zM8 7h2v2H8zm4 0h2v2h-2zm4 0h2v2h-2zM8 11h2v2H8zm4 0h2v2h-2zm4 0h2v2h-2zM8 15h2v2H8zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                    </svg>
                    <h2 class="text-2xl font-bold text-white">Conversor de Divisas</h2>
                </div>

                <div class="space-y-4">
                    <div>
                        <label for="usd-input" class="block text-gray-400 font-medium mb-1">Dólar (USD)</label>
                        <input type="number" id="usd-input" placeholder="0.00" class="w-full bg-gray-600 text-white p-3 rounded-xl border border-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-500">
                    </div>
                    
                    <div>
                        <label for="bs-input" class="block text-gray-400 font-medium mb-1">Bolívar Soberano (Bs.)</label>
                        <input type="number" id="bs-input" placeholder="0.00" class="w-full bg-gray-600 text-white p-3 rounded-xl border border-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-500">
                    </div>
                </div>
            </div>
        </section>

        <section id="info" class="hidden">
            <hr class="border-gray-700 my-8">
            <!-- Sección de información (Info) -->
            <div class="bg-gray-700 p-6 rounded-2xl shadow-lg border border-gray-600 text-center">
                <h2 class="text-2xl font-bold text-white mb-2">Información</h2>
                <p class="text-gray-300">Desarrollado por Francisco Rosales.</p>
                <p class="text-gray-300">2025</p>
            </div>
        </section>

    </main>

    <script>
        // Use a flag to avoid multiple API calls at once
        let isFetching = false;
        let exchangeRateData = null;

        // Función para mostrar la sección seleccionada y ocultar las demás
        function showSection(sectionId) {
            const sections = ['tasa-cambio', 'calculadora', 'info'];
            const links = ['link-tasa', 'link-calculadora', 'link-info'];

            sections.forEach(id => {
                const section = document.getElementById(id);
                if (section) {
                    section.classList.add('hidden');
                }
            });

            links.forEach(id => {
                const link = document.getElementById(id);
                if (link) {
                    link.classList.remove('text-orange-500');
                    link.classList.add('text-gray-300');
                }
            });

            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.classList.remove('hidden');
            }

            const selectedLink = document.getElementById(`link-${sectionId.replace('-', '')}`);
            if (selectedLink) {
                selectedLink.classList.add('text-orange-500');
                selectedLink.classList.remove('text-gray-300');
            }
        }

        async function fetchExchangeRates() {
            // Check if a fetch is already in progress
            if (isFetching) return;
            isFetching = true;

            const today = new Date().getDay(); // 0 = Domingo, 1 = Lunes, ..., 6 = Sábado
            
            // No actualizar los sábados (6) ni domingos (0)
            if (today === 6 || today === 0) {
                console.log("No se actualiza la tasa de cambio en fines de semana.");
                isFetching = false;
                return Promise.resolve(null);
            }

            const apiUrl = 'https://ve.dolarapi.com/v1/dolares/oficial';
            
            try {
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                // La API retorna la tasa oficial del BCV
                const rate = data.promedio;
                const lastUpdated = data.fechaActualizacion;

                if (!rate || !lastUpdated) {
                    throw new Error('No se encontró la tasa de cambio o la fecha de actualización.');
                }
                
                return {
                    usd: rate,
                    lastUpdated: new Date(lastUpdated)
                };

            } catch (error) {
                console.error("Error al obtener las tasas de cambio de la API:", error);
                throw error;
            } finally {
                isFetching = false;
            }
        }

        // Función para actualizar la interfaz de usuario con los datos obtenidos
        function updateUI(rates) {
            const usdRateElement = document.getElementById('usd-rate');
            const usdUpdatedElement = document.getElementById('usd-last-updated');
            const statusMessageElement = document.getElementById('status-message');

            if (rates && rates.usd) {
                usdRateElement.textContent = `Bs. ${rates.usd.toFixed(2)}`;

                const formattedTime = rates.lastUpdated.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                usdUpdatedElement.textContent = `Actualizado: ${formattedTime}`;

                statusMessageElement.classList.add('hidden');
                
                // Actualiza la calculadora con la nueva tasa
                document.getElementById('usd-input').value = '';
                document.getElementById('bs-input').value = '';

                exchangeRateData = rates;

            } else {
                // Muestra un mensaje de error si no se pueden obtener los datos
                usdRateElement.textContent = '--';
                usdUpdatedElement.textContent = 'Actualizado: --/--/----';
                statusMessageElement.classList.remove('hidden');
            }
        }

        // Maneja el clic del botón de actualización
        async function handleUpdateClick() {
            const button = document.getElementById('update-button');
            const originalButtonText = button.textContent;
            
            button.textContent = 'Actualizando...';
            button.classList.add('button-loading');

            try {
                const rates = await fetchExchangeRates();
                if (rates !== null) {
                    updateUI(rates);
                } else {
                    // Si no hay nueva actualización, muestra un mensaje
                    document.getElementById('status-message').textContent = 'La tasa de cambio se actualiza solo de lunes a viernes.';
                    document.getElementById('status-message').classList.remove('hidden');
                }
            } catch (error) {
                console.error("Error al actualizar las tasas de cambio:", error);
                updateUI(null);
            } finally {
                button.textContent = originalButtonText;
                button.classList.remove('button-loading');
            }
        }

        // Función para manejar la conversión en la calculadora
        function handleConversion(event) {
            const usdInput = document.getElementById('usd-input');
            const bsInput = document.getElementById('bs-input');
            
            if (!exchangeRateData || !exchangeRateData.usd) {
                return;
            }
            
            const rate = exchangeRateData.usd;
            
            if (event.target.id === 'usd-input') {
                const usdAmount = parseFloat(usdInput.value);
                if (!isNaN(usdAmount)) {
                    bsInput.value = (usdAmount * rate).toFixed(2);
                } else {
                    bsInput.value = '';
                }
            } else if (event.target.id === 'bs-input') {
                const bsAmount = parseFloat(bsInput.value);
                if (!isNaN(bsAmount)) {
                    usdInput.value = (bsAmount / rate).toFixed(2);
                } else {
                    usdInput.value = '';
                }
            }
        }

        // Ejecuta la lógica principal cuando la página se carga
        (function init() {
            const updateButton = document.getElementById('update-button');
            const usdInput = document.getElementById('usd-input');
            const bsInput = document.getElementById('bs-input');

            updateButton.addEventListener('click', handleUpdateClick);
            usdInput.addEventListener('input', handleConversion);
            bsInput.addEventListener('input', handleConversion);
            
            // Obtener la tasa de cambio al cargar la página
            handleUpdateClick();
        })();

    </script>
</body>
</html>
